import{_ as s,o as a,c as e,$ as t}from"./chunks/framework.9fa1e75e.js";const h=JSON.parse('{"title":"Media APIs","description":"","frontmatter":{},"headers":[],"relativePath":"reference/api/media.md","filePath":"reference/api/media.md","lastUpdated":1690289066000}'),o={name:"reference/api/media.md"},n=t(`<h1 id="media-apis" tabindex="-1">Media APIs <a class="header-anchor" href="#media-apis" aria-label="Permalink to &quot;Media APIs&quot;">​</a></h1><p>The <code>@apostrophecms/attachment</code> module manages all media file uploading. Once uploaded, an attachment object should typically be added to an Apostrophe piece or page document (including, but not limited to, <code>@apostrophecms/image</code> and <code>@apostrophecms/file</code> pieces). It is not common, and not generally recommended, to leave uploaded attachments unconnected from any Apostrophe document.</p><p>For attachments meant to be included in the media or file libraries, metadata and organization those media are primarily managed through the respective <code>@apostrophecms/image</code> and <code>@apostrophecms/file</code> piece types. See the <a href="./pieces.html">pieces REST API documentation</a> for additional information.</p><h2 id="endpoints" tabindex="-1">Endpoints <a class="header-anchor" href="#endpoints" aria-label="Permalink to &quot;Endpoints&quot;">​</a></h2><table><thead><tr><th>Method</th><th>Path</th><th>Description</th><th>Auth required</th></tr></thead><tbody><tr><td><code>POST</code></td><td><a href="#post-api-v1-apostrophecms-attachment-upload"><code>/api/v1/@apostrophecms/attachment/upload</code></a></td><td>Upload a media file</td><td>TRUE</td></tr><tr><td><code>POST</code></td><td><a href="#post-api-v1-apostrophecms-attachment-crop"><code>/api/v1/@apostrophecms/attachment/crop</code></a></td><td>Crop an image file</td><td>TRUE</td></tr><tr><td><code>GET</code></td><td><a href="#media-get-request"><code>/api/v1/@apostrophecms/image</code></a></td><td>Get an image document with a specified ID</td><td>FALSE</td></tr><tr><td><code>POST</code></td><td><a href="#media-post-request"><code>/api/v1/@apostrophecms/image</code></a></td><td>Insert a new image</td><td>TRUE</td></tr><tr><td><code>GET</code></td><td><a href="#media-get-request"><code>/api/v1/@apostrophecms/file</code></a></td><td>Get a file document with a specified ID</td><td>FALSE</td></tr><tr><td><code>POST</code></td><td><a href="#media-post-request"><code>/api/v1/@apostrophecms/file</code></a></td><td>Insert a new file</td><td>TRUE</td></tr></tbody></table><h2 id="post-api-v1-apostrophecms-attachment-upload" tabindex="-1"><code>POST /api/v1/@apostrophecms/attachment/upload</code> <a class="header-anchor" href="#post-api-v1-apostrophecms-attachment-upload" aria-label="Permalink to &quot;\`POST /api/v1/@apostrophecms/attachment/upload\`&quot;">​</a></h2><p><strong>Authentication required.</strong></p><p>The <code>body</code> of the request should use the <code>multipart/form-data</code> encoding, with the file itself uploaded under the name <code>file</code>. In a client-side request, the <code>body</code> of the request should be a <code>FormData</code> object.</p><h3 id="request-example" tabindex="-1">Request example <a class="header-anchor" href="#request-example" aria-label="Permalink to &quot;Request example&quot;">​</a></h3><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Create a \`FormData\` object</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> formData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">FormData</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Append a file as per the FormData API:</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// https://developer.mozilla.org/en-US/docs/Web/API/FormData/append</span></span>
<span class="line"><span style="color:#A6ACCD;">formData</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">file</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> myfile)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Request inside an async function.</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> attachment </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/v1/@apostrophecms/attachment/upload</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">Content-Type</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">multipart/form-data</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> formData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><h3 id="response" tabindex="-1">Response <a class="header-anchor" href="#response" aria-label="Permalink to &quot;Response&quot;">​</a></h3><p>The successful <code>POST</code> request returns the newly created attachment. In case of an error an appropriate HTTP status code is returned.</p><table><thead><tr><th>Property</th><th>Format</th><th>Description</th></tr></thead><tbody><tr><td><code>_id</code></td><td>String</td><td>A unique and permanent ID for the attachment</td></tr><tr><td><code>_url</code></td><td>String</td><td>The file URL (the original size, if an image)</td></tr><tr><td><code>_urls</code></td><td>Object</td><td>An object with keys for the generated image size variants, if an image file</td></tr><tr><td><code>archivedDocIds</code></td><td>Array</td><td>An array of string IDs that represent image or file documents using this attachment that are archived</td></tr><tr><td><code>createdAt</code></td><td>Date</td><td>An <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noreferrer">ISO date string</a> of the attachment&#39;s creation date and time</td></tr><tr><td><code>docIds</code></td><td>Array</td><td>An array of string IDs that represent image or file documents using this attachment (empty at initial upload)</td></tr><tr><td><code>extension</code></td><td>String</td><td>The file&#39;s file extension, e.g., <code>png</code>, <code>pdf</code></td></tr><tr><td><code>group</code></td><td>String</td><td>The associated file group, including <code>image</code> or <code>office</code> by default</td></tr><tr><td><code>height</code></td><td>Number</td><td>Height of the image file, if an image</td></tr><tr><td><code>landscape</code></td><td>Boolean</td><td><code>true</code> if an image with landscape aspect ratio</td></tr><tr><td><code>length</code></td><td>Number</td><td>The file size in bytes</td></tr><tr><td><code>md5</code></td><td>String</td><td>MD5 checksum value for the file</td></tr><tr><td><code>name</code></td><td>String</td><td>A &quot;slugified&quot; version of the file name (generally lowercased and joined with dashes)</td></tr><tr><td><code>portrait</code></td><td>Boolean</td><td><code>true</code> if an image with portrait aspect ratio</td></tr><tr><td><code>title</code></td><td>String</td><td>A &quot;sortified&quot; version of the file name (case-insensitive)</td></tr><tr><td><code>type</code></td><td>String</td><td>&#39;attachment&#39;</td></tr><tr><td><code>updatedAt</code></td><td>Date</td><td>An <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noreferrer">ISO date string</a> of the attachment&#39;s last update date and time</td></tr><tr><td><code>width</code></td><td>Number</td><td>Width of the image file, if an image</td></tr></tbody></table><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// This is a PNG upload with filename \`blue-box.png\`</span></span>
<span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ckj0akbxa003vp39kfbxgb8zg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">group</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">images</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">createdAt</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2020-12-22T17:58:11.314Z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">blue-box</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">title</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">blue box</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">extension</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">attachment</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">docIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">archivedDocIds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">length</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10497</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">md5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">630eeaaecd0bdc07c4a82eeca4c07588</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">width</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">600</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">height</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">106</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">landscape</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">true,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">_urls</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">max</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.max.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">full</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.full.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">two-thirds</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.two-thirds.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">one-half</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.one-half.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">one-third</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.one-third.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">one-sixth</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.one-sixth.png</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">original</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://example.net/uploads/attachments/ckj0akbxa003vp39kfbxgb8zg-blue-box.png</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="post-api-v1-apostrophecms-attachment-crop" tabindex="-1"><code>POST /api/v1/@apostrophecms/attachment/crop</code> <a class="header-anchor" href="#post-api-v1-apostrophecms-attachment-crop" aria-label="Permalink to &quot;\`POST /api/v1/@apostrophecms/attachment/crop\`&quot;">​</a></h2><p><strong>Authentication required.</strong></p><p>This route uploads a new, cropped version of an existing image. The <code>crop</code> object is appended to the <code>crops</code> array property of the attachment document.</p><p>The <code>body</code> of the request should include:</p><table><thead><tr><th>Property</th><th>Format</th><th>Description</th></tr></thead><tbody><tr><td><code>_id</code></td><td>String</td><td>The <code>_id</code> property of an existing image attachment document</td></tr><tr><td><code>crop</code></td><td>Object</td><td>An object containing <code>top</code>, <code>left</code>, <code>width</code> and <code>height</code> properties</td></tr></tbody></table><p>The newly uploaded image file will be stored with a file name using the <code>crop</code> properties as well as the <code>_id</code>, <code>name</code>, and file extension of the original attachment, formatted as <code>{_id}-{name}.{top}.{left}.{width}.{height}.{extension}</code></p><h3 id="response-1" tabindex="-1">Response <a class="header-anchor" href="#response-1" aria-label="Permalink to &quot;Response&quot;">​</a></h3><p>The successful <code>POST</code> request returns <code>true</code>. In case of an error an appropriate HTTP status code is returned.</p><h2 id="media-get-request" tabindex="-1">Media <code>GET</code> request <a class="header-anchor" href="#media-get-request" aria-label="Permalink to &quot;Media \`GET\` request&quot;">​</a></h2><p>Endpoints:</p><ul><li><code>GET /api/v1/@apostrophecms/image</code></li><li><code>GET /api/v1/@apostrophecms/file</code></li></ul><p>A <code>GET</code> request for an image or file is generally a normal <a href="./pieces.html#get-api-v1-piece-name-id">piece type <code>GET</code> request</a>. In addition to the typical piece document properties, it will also include an <code>attachment</code> property, containing an object similar to one returned from <a href="#post-api-v1-apostrophecms-attachment-upload">an attachment upload request</a>.</p><h2 id="media-post-request" tabindex="-1">Media <code>POST</code> request <a class="header-anchor" href="#media-post-request" aria-label="Permalink to &quot;Media \`POST\` request&quot;">​</a></h2><p><strong>Authentication required.</strong></p><ul><li><code>POST /api/v1/@apostrophecms/image</code></li><li><code>POST /api/v1/@apostrophecms/file</code></li></ul><p>A <code>POST</code> request for an image or file is generally a normal <a href="./pieces.html#get-api-v1-piece-name-id">piece type <code>POST</code> request</a>. In addition to the typical piece document properties, it must also include an <code>attachment</code> property, containing the attachment object returned from <a href="#post-api-v1-apostrophecms-attachment-upload">an attachment upload request</a>.</p>`,30),p=[n];function l(c,r,d,i,D,F){return a(),e("div",null,p)}const u=s(o,[["render",l]]);export{h as __pageData,u as default};
