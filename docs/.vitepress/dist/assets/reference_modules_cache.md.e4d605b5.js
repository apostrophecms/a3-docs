import{_ as o,K as l,o as t,c as p,O as c,k as s,a,$ as r}from"./chunks/framework.9fa1e75e.js";const w=JSON.parse('{"title":"@apostrophecms/cache","description":"","frontmatter":{"extends":"@apostrophecms/module"},"headers":[],"relativePath":"reference/modules/cache.md","filePath":"reference/modules/cache.md","lastUpdated":1690289066000}'),y={name:"reference/modules/cache.md"},i=s("h1",{id:"apostrophecms-cache",tabindex:"-1"},[s("code",null,"@apostrophecms/cache"),a(),s("a",{class:"header-anchor",href:"#apostrophecms-cache","aria-label":'Permalink to "`@apostrophecms/cache`"'},"​")],-1),D=s("p",null,[s("strong",null,"Alias:"),a(),s("code",null,"apos.cache")],-1),F=r(`<p>The <code>@apostrophecms/cache</code> module is a general-purpose cache implementation for improved performance in all areas where results can be retained and reused temporarily. Any number of namespaces can be used to separately maintain data. It is powered by a MongoDB collection.</p><h2 id="methods" tabindex="-1">Methods <a class="header-anchor" href="#methods" aria-label="Permalink to &quot;Methods&quot;">​</a></h2><h3 id="async-set-namespace-key-value-lifetime" tabindex="-1"><code>async set(namespace, key, value, lifetime)</code> <a class="header-anchor" href="#async-set-namespace-key-value-lifetime" aria-label="Permalink to &quot;\`async set(namespace, key, value, lifetime)\`&quot;">​</a></h3><p>The <code>set()</code> method is asynchronous and should be called with an await to insure that any data is cached prior to trying to retrieve it. The method takes four parameters. The first, <code>namespace</code>, takes a string and is used to prevent collisions between keys when caching unrelated data. The <code>key</code> parameter takes a string and is the identifier that can be used to retrieve the item to be stored. The <code>value</code> parameter takes any JSON-friendly value and does not need to be stringified. The optional <code>lifetime</code> parameter takes the number of seconds for the value to exist as an integer. If set to zero or unspecified then there won&#39;t be an expiration time. However, the cache should not be used for primary storage as it could be cleared at any time, partially cleared to free space, et cetera.</p><h4 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">…</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">http://api.weatherapi.com/v1/forecast.json?q=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">zipCode</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Check the cache for the data we want</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> weatherData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">apos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">weatherApi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> zipCode)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">weatherData) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// The data wasn&#39;t cached, so let&#39;s get it the hard way</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">weatherData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// let&#39;s cache for an hour = 60 seconds * 60 minutes = 3600</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">apos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">weatherApi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">zipCode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">weatherData</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3600</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Now we can use the data</span></span>
<span class="line"><span style="color:#A6ACCD;">…</span></span></code></pre></div><h3 id="async-get-namespace-key" tabindex="-1"><code>async get(namespace, key)</code> <a class="header-anchor" href="#async-get-namespace-key" aria-label="Permalink to &quot;\`async get(namespace, key)\`&quot;">​</a></h3><p>The <code>get()</code> method is asynchronous and should be called with await. It allows you to retrieve a value that was previously added to the database by the <code>set()</code> method. The retrieved value is specified by the same <code>namespace</code> string and <code>key</code> string used in the <code>set()</code> method. This method returns the cached value or <code>undefined</code> if the specified key does not exist in the specified namespace.</p><h4 id="example-1" tabindex="-1">Example <a class="header-anchor" href="#example-1" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">…</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Check the cache for the data we want</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">http://api.weatherapi.com/v1/forecast.json?q=</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">zipCode</span><span style="color:#89DDFF;">}\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Check the cache for the data we want</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> weatherData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">apos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">weatherApi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> zipCode)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">weatherData) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// The data wasn&#39;t cached, so let&#39;s get it the hard way</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">options</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">weatherData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">response</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// let&#39;s cache for an hour = 60 seconds * 60 minutes = 3600</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">apos</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">cache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">weatherApi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">zipCode</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">weatherData</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">3600</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Now we can use the data</span></span>
<span class="line"><span style="color:#A6ACCD;">…</span></span></code></pre></div><h3 id="async-clear-namespace" tabindex="-1"><code>async clear(namespace)</code> <a class="header-anchor" href="#async-clear-namespace" aria-label="Permalink to &quot;\`async clear(namespace)\`&quot;">​</a></h3><p>The <code>clear()</code> method is an asynchronous method and should be called with await. The method clears all keys that were set with the same <code>namespace</code> argument.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>This method clears an entire namespace. To overwrite a single key&#39;s value, just call the <code>set()</code> method again.</p></div><h2 id="module-tasks" tabindex="-1">Module tasks <a class="header-anchor" href="#module-tasks" aria-label="Permalink to &quot;Module tasks&quot;">​</a></h2><h3 id="clear-cache-namespace-s" tabindex="-1"><code>clear-cache &lt;namespace(s)&gt;</code> <a class="header-anchor" href="#clear-cache-namespace-s" aria-label="Permalink to &quot;\`clear-cache &lt;namespace(s)&gt;\`&quot;">​</a></h3><p>This CLI task will clear all of the values in the supplied namespace(s).</p><p>Full command: <code>node app @apostrophecms/cache:clear-cache namespace1 namespace2</code></p>`,17);function d(e,h,A,C,m,u){const n=l("AposRefExtends");return t(),p("div",null,[i,D,c(n,{module:e.$frontmatter.extends},null,8,["module"]),F])}const k=o(y,[["render",d]]);export{w as __pageData,k as default};
