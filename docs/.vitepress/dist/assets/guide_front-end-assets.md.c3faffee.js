import{_ as e,o as s,c as o,$ as a}from"./chunks/framework.9fa1e75e.js";const f=JSON.parse('{"title":"Adding front end CSS and JavaScript","description":"","frontmatter":{"prev":{"text":"Modules","link":"guide/modules.md"},"next":{"text":"Front end code tips","link":"guide/front-end-tips.md"}},"headers":[],"relativePath":"guide/front-end-assets.md","filePath":"guide/front-end-assets.md","lastUpdated":1690289066000}'),t={name:"guide/front-end-assets.md"},n=a(`<h1 id="adding-front-end-css-and-javascript" tabindex="-1">Adding front end CSS and JavaScript <a class="header-anchor" href="#adding-front-end-css-and-javascript" aria-label="Permalink to &quot;Adding front end CSS and JavaScript&quot;">‚Äã</a></h1><p>ApostropheCMS approaches CSS and client-side JavaScript by trying to taking care of as much of the hard parts as possible. To that end, the developers main job is to <strong>put their SCSS and client-side JavaScript into <code>ui/src/index.scss</code> and <code>ui/src/index.js</code> files in the relevant module</strong>. Apostrophe will then:</p><ul><li>Compile <a href="https://sass-lang.com/guide" target="_blank" rel="noreferrer">SCSS</a> from <code>*.scss</code> files to CSS</li><li>Optionally use Babel to automatically compile modern JavaScript into an Internet Explorer 11-compatible form</li><li>Interpret all <code>import</code> statements and deliver the code to browsers in one CSS and one JavaScript file, either: <ul><li>with the editing UI if the browser is logged in, or</li><li>without the editing UI if logged out</li></ul></li></ul><h2 id="placing-client-side-code" tabindex="-1">Placing client-side code <a class="header-anchor" href="#placing-client-side-code" aria-label="Permalink to &quot;Placing client-side code&quot;">‚Äã</a></h2><p>SCSS and JavaScript files need to be placed in <strong>any module&#39;s <code>ui/src/index.scss</code> and <code>ui/src/index.js</code> files</strong>, or files imported from them. You can put client-side code in a single module directory (e.g., using <code>import</code> statements) or spread it across many modules.</p><p>For example, if we had a global SCSS file, <code>site.scss</code>, we might create an <code>asset</code> module for this purpose and place the SCSS file at:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">modules/asset/ui/src/index.scss</span></span></code></pre></div><p>We would also need to activate the module in <code>app.js</code> like any other.</p><p>We could instead add code for an individual widget type as shown in the <a href="/guide/custom-widgets.html#client-side-javascript-for-widgets">custom widget guide</a>. That example&#39;s JavaScript code was placed at:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">modules/collapse-widget/ui/src/index.js</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you have your own build process using something like webpack or Gulp, you will want to <a href="#using-your-own-build-process">push the output of your process to a <code>ui/public</code> folder instead</a>.</p><p>In this case, the <code>assets</code> module may not have any additional code and even may not have an <code>index.js</code> file (though it certainly could). As long as it is instantiated in <code>apps.js</code>, the client-side assets will be found.</p></div><p>Client side code will be recompiled <strong>when the app starts up</strong> or if <strong>the build task runs</strong>. Tools like <a href="https://www.npmjs.com/package/nodemon" target="_blank" rel="noreferrer">nodemon</a> are helpful to watch for code changes and restart the app for automatic recompiling. The CLI command to run the build task manually is <code>node app @apostrophecms/asset:build</code>.</p><h2 id="executing-your-javascript-code-in-the-right-order" tabindex="-1">Executing your JavaScript code in the right order <a class="header-anchor" href="#executing-your-javascript-code-in-the-right-order" aria-label="Permalink to &quot;Executing your JavaScript code in the right order&quot;">‚Äã</a></h2><p>If you spread the client-side code across modules, it will be imported in the order they are instantiated in <code>app.js</code>. For example, let&#39;s say you have JavaScript files in <code>modules/sing-widget/ui/src/index.js</code> and <code>modules/dance-widget/ui/src/index.js</code>.</p><p>The <code>sing-widget</code> sings:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// \`modules/sing-widget/ui/public/singing.js</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">üßë‚Äçüé§üé∂</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>And the <code>dance-widget</code> dances:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// \`modules/dance-widget/ui/public/dancing.js</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">üï∫üèªüíÉüèΩ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>If your module&#39;s configuration in <code>app.js</code> includes this:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app.js</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sing-widget</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dance-widget</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{},</span></span></code></pre></div><p>The output will <strong>sing</strong> before it <strong>dances</strong>. If the modules are instantiated in the opposite order:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app.js</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dance-widget</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sing-widget</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{},</span></span></code></pre></div><p>the output will <strong>dance</strong> before it <strong>sings</strong>.</p><div class="info custom-block"><p class="custom-block-title">Why do I have to export a function?</p><p>A funny thing about JavaScript <code>import</code> statements: they don&#39;t guarantee any order in which the files are loaded. To fix that, Apostrophe requires you to export a function from each <code>ui/src/index.js</code> file so that it can call them in the order the modules are initialized.</p></div><h2 id="ordering-the-scss-files" tabindex="-1">Ordering the SCSS files <a class="header-anchor" href="#ordering-the-scss-files" aria-label="Permalink to &quot;Ordering the SCSS files&quot;">‚Äã</a></h2><p>Rules found in or imported by <code>ui/src/index.scss</code> files are compiled in the order the modules are activated in <code>app.js</code>.</p><div class="info custom-block"><p class="custom-block-title">The Boilerplate</p><p>The <a href="https://github.com/apostrophecms/a3-boilerplate/" target="_blank" rel="noreferrer">Apostrophe 3 boilerplate</a> takes advantage of <code>ui/src</code> in exactly the same way. The <code>asset</code> module contains <code>ui/src/index.js</code> and <code>ui/src/index.scss</code> files, which Apostrophe automatically discovers.</p></div><h2 id="supporting-internet-explorer-11" tabindex="-1">Supporting Internet Explorer 11 <a class="header-anchor" href="#supporting-internet-explorer-11" aria-label="Permalink to &quot;Supporting Internet Explorer 11&quot;">‚Äã</a></h2><p>Internet Explorer 11 is <a href="https://blogs.windows.com/windowsexperience/2021/05/19/the-future-of-internet-explorer-on-windows-10-is-in-microsoft-edge/#:~:text=With%20Microsoft%20Edge%20capable%20of,certain%20versions%20of%20Windows%2010." target="_blank" rel="noreferrer">going away soon</a>, but for now at least some projects still require support for it.</p><p>By default, Apostrophe does <em>not</em> guarantee that code written in modern JavaScript in <code>ui/src/index.js</code> files will run in Internet Explorer 11. However, you can turn on support by setting the <code>es5: true</code> option of the <code>@apostrophecms/asset</code> module:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// modules/@apostrophecms/asset/index.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">options</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">es5</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>This configures Apostrophe to compile two JavaScript bundles: one for Internet Explorer 11 users, and one for everyone else. The Internet Explorer 11 bundle contains code compiled with <code>babel</code> in order to add support for missing features, as well as polyfills for missing functions.</p><p>That makes the bundle larger, but Apostrophe serves a separate, small and fast bundle to non-IE11 users, so there is <strong>no performance penalty</strong> for them.</p><div class="info custom-block"><p class="custom-block-title">Internet Explorer 11 limitations</p><p>Apostrophe uses babel&#39;s <code>@babel/preset-env</code> module to provide as much support as possible for JavaScript language features, including promises, <code>async/await</code> and more. However, Apostrophe does not provide polyfills for all browser API features, and some, such as <code>Observable</code>, cannot be implemented for Internet Explorer 11. Apostrophe also does not attempt to fix the limitations of CSS in Internet Explorer 11. And the most important limitation is that <strong>Apostrophe&#39;s editing interface is not available in Internet Explorer 11.</strong> You should test your sites thoroughly in all browsers you intend to support.</p></div><h2 id="using-your-own-build-process" tabindex="-1">Using your own build process <a class="header-anchor" href="#using-your-own-build-process" aria-label="Permalink to &quot;Using your own build process&quot;">‚Äã</a></h2><p>Apostrophe&#39;s built-in <code>ui/src</code> feature is very handy, and sufficient for most sites. And if it isn&#39;t quite powerful enough, you can <a href="./webpack.html">extend it to meet your needs</a>. In most cases that is the best way forward.</p><p>However, if after reading that guide you still wish to create your own build process,then you&#39;ll want to take a different path. This is where <code>ui/public</code> comes in.</p><p>The basic idea is that your build process should produce just one output <code>.js</code> file, and possibly a <code>.css</code> file too. Then you can feed those into Apostrophe by creating a generic module, like <code>asset</code>, and configuring your own build process to write its output to <code>modules/asset/ui/public/index.js</code> and <code>modules/asset/ui/public/index.css</code>.</p><h3 id="the-ui-public-folder" tabindex="-1">The <code>ui/public</code> folder <a class="header-anchor" href="#the-ui-public-folder" aria-label="Permalink to &quot;The \`ui/public\` folder&quot;">‚Äã</a></h3><p><code>ui/public</code> is similar to <code>ui/src</code>, with one important difference: Apostrophe imports the code exactly &quot;as-is.&quot; Similar like <code>ui/src</code>, a <code>ui/public</code> folder can exist in any number of modules. However unlike <code>ui/src</code> its contents are concatenated into the asset bundle that Apostrophe creates, with no compilation or interpretation of any kind. This makes it perfect for the output of your own build process.</p><p>Here&#39;s how it works in a typical project with its own build process:</p><ul><li>The project&#39;s JavaScript and styles are in a <code>src</code> folder at the root of the project, which always contains at least <code>index.js</code> and often <code>index.scss</code> as starting points, assuming that SCSS files are part of your build process.</li><li>The <code>dev</code> npm script in <code>package.json</code> runs your build process. If you&#39;re using webpack, that script might compile <code>src/index.js</code> and <code>src/index.scss</code> according to the rules in <code>webpack.config.js</code>.</li><li>At the end of the build, the bundled assets are written to <code>modules/asset/ui/public/sites.js</code>.</li><li>Any <code>.js</code> files Apostrophe finds in the <code>ui/public</code> folder of any module are automatically included in the asset bundle served to the visitor.</li><li>Whenever code changes are made, <code>nodemon</code> automatically restarts this cycle and refreshes the browser after a successful restart.</li></ul><p>But you don&#39;t have to use SCSS, webpack or any other specifics mentioned here, except for pushing the output into a <code>ui/public</code> folder so that Apostrophe can find it. You can follow whatever process works best for you or your organization.</p><h3 id="what-about-other-static-assets-for-my-module" tabindex="-1">What about other static assets for my module? <a class="header-anchor" href="#what-about-other-static-assets-for-my-module" aria-label="Permalink to &quot;What about other static assets for my module?&quot;">‚Äã</a></h3><p>If you have a need for static asset files like images and would like to ship them with individual modules, see the advanced topic <a href="./static-module-assets.html">static module assets</a>.</p>`,45),i=[n];function l(r,c,p,d,u,h){return s(),o("div",null,i)}const m=e(t,[["render",l]]);export{f as __pageData,m as default};
