import{_ as n,K as p,o as c,c as r,O as a,w as o,$ as l,k as e,a as s}from"./chunks/framework.9fa1e75e.js";const q=JSON.parse('{"title":"Inserting and updating in server-side code","description":"","frontmatter":{"prev":{"text":"Database Queries","link":"guide/database-queries.md"},"next":{"text":"Accessing the database directly","link":"guide/database-access.md"}},"headers":[],"relativePath":"guide/database-insert-update.md","filePath":"guide/database-insert-update.md","lastUpdated":1690289066000}'),i={name:"guide/database-insert-update.md"},d=l('<h1 id="inserting-and-updating-in-server-side-code" tabindex="-1">Inserting and updating in server-side code <a class="header-anchor" href="#inserting-and-updating-in-server-side-code" aria-label="Permalink to &quot;Inserting and updating in server-side code&quot;">​</a></h1><p>Apostrophe provides module methods for inserting and updating content documents in the database. These methods should be the primary tools for developers doing server-side data operations since they <a href="/guide/server-events.html">emit events</a> that the CMS uses to keep all database collections updated and in sync. We will look at methods for both pieces and pages, which are similar but have some important differences.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>Remember that the Apostrophe REST APIs for <a href="/reference/api/pieces.html">pieces</a> and <a href="/reference/api/pages.html">pages</a> are usually the best option when triggering content updates from the browser. Those API endpoints take advantage of the methods below while adding logic important to use in browsers.</p></div><h2 id="updating-content-documents" tabindex="-1">Updating content documents <a class="header-anchor" href="#updating-content-documents" aria-label="Permalink to &quot;Updating content documents&quot;">​</a></h2><p>When we have an existing piece document that to update, we use the <code>update()</code> method on the related piece type module. The <code>update</code> method takes the following arguments:</p><table><thead><tr><th>Argument</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>req</code></td><td>TRUE</td><td>The associated request object. Using a provided <code>req</code> object is important for maintaining user role permissions.</td></tr><tr><td><code>piece</code></td><td>TRUE</td><td>The document object that will <em>replace</em> the existing database document.</td></tr><tr><td><code>options</code></td><td>FALSE</td><td>An options object, currently only used for internal draft state management.</td></tr></tbody></table><p>For example, if we had a dog adoption website that used an external API, we may want to update <code>dog</code> pieces periodically with adoption status. This may be using a command line task that is run regularly by a cron job.</p>',7),y=e("div",{class:"language-javascript"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"javascript"),e("pre",{class:"shiki material-theme-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"module.exports"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#F07178"}},"extend"),e("span",{style:{color:"#89DDFF"}},":"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"@apostrophecms/piece-type"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#89DDFF"}},",")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"  "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// ...")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#F07178"}},"methods"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"("),e("span",{style:{color:"#A6ACCD","font-style":"italic"}},"self"),e("span",{style:{color:"#89DDFF"}},")"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"    "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"      "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// The hypothetical method is run once for each dog we're following from")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"      "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// the API. A separate method would add any new dogs.")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#C792EA"}},"async"),e("span",{style:{color:"#F07178"}}," updateDogStatus"),e("span",{style:{color:"#89DDFF"}},"("),e("span",{style:{color:"#A6ACCD","font-style":"italic"}},"req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD","font-style":"italic"}},"dogId"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD","font-style":"italic"}},"status"),e("span",{style:{color:"#89DDFF"}},")"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#C792EA"}},"const"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"dogDocument"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"find"),e("span",{style:{color:"#F07178"}},"("),e("span",{style:{color:"#A6ACCD"}},"req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"          "),e("span",{style:{color:"#A6ACCD"}},"dogId")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF"}},"}"),e("span",{style:{color:"#F07178"}},")"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"toObject"),e("span",{style:{color:"#F07178"}},"()"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"if"),e("span",{style:{color:"#F07178"}}," ("),e("span",{style:{color:"#89DDFF"}},"!"),e("span",{style:{color:"#A6ACCD"}},"dogDocument"),e("span",{style:{color:"#F07178"}},") "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"          "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"null;")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF"}},"};")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"        "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// We update the `status` property.")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#A6ACCD"}},"dogDocument"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#A6ACCD"}},"status"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"status"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#C792EA"}},"const"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"updateResult"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"update"),e("span",{style:{color:"#F07178"}},"("),e("span",{style:{color:"#A6ACCD"}},"req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"dogDocument"),e("span",{style:{color:"#F07178"}},")"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"updateResult"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"    "),e("span",{style:{color:"#89DDFF"}},"};")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"  "),e("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"};")])])])],-1),F=l(`<p><strong>What is happening here?</strong></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">async </span><span style="color:#82AAFF;">updateDogStatus</span><span style="color:#A6ACCD;">(req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> dogId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> status) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dogDocument</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">req</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">dogId</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toObject</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Our method received the active request object, the API&#39;s identifier for a dog, and the dog&#39;s availability status (probably a string value). We then request the <em>full</em> database document. See the <a href="/guide/database-queries.html">database querying guide</a> for more on this.</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">dogDocument) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>If the identified dog isn&#39;t in our database yet, we would return a <code>null</code> value and the update task&#39;s function could insert the dog instead.</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// We update the \`status\` property.</span></span>
<span class="line"><span style="color:#A6ACCD;">dogDocument</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> updatedDraft </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#A6ACCD;">(req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> dogDocument)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> updatedDraft</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>We update the document property that tracks the dog&#39;s adoption status on the data object and use <code>self.update</code> to replace the previous document state with our update (with <code>await</code> as it is asynchronous). We finally return the result, which will be the updated document object.</p><p>Note that using the provided <code>req</code> object like this works only if the <code>req</code> object is from a user with <em>at least</em> &quot;contributor&quot; permissions for the <code>dog</code> piece type. <strong>If we wanted to bypass that permission check</strong>, or if we ever wanted to allow anonymous site visitors to insert or update content, we would pass <code>{ permissions: false }</code> as a third options argument to <code>self.update()</code>. That obviously raises security issues we would need to consider carefully.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>All content documents have multiple versions, including &quot;draft&quot; and &quot;published&quot; versions. The <code>update()</code> methods only updates the &quot;draft&quot; copy, allowing editors to still review before publishing. If we <em>did</em> want to publish here as well, we would want to run the publishing method:</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> self</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">publish</span><span style="color:#A6ACCD;">(req</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> updatedDraft)</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p><strong>What if we are updating a document from a different doc type module?</strong></p><p>In the example above, <code>self</code> refers to the <code>dog</code> piece type module since that is where the method is registered. If we wanted to run the <code>update</code> method from a separate module we would replace <code>self</code> with a specific reference to the <code>dog</code> module: <strong><code>self.apos.modules.dog</code></strong>.</p></div><h3 id="updating-page-documents" tabindex="-1">Updating page documents <a class="header-anchor" href="#updating-page-documents" aria-label="Permalink to &quot;Updating page documents&quot;">​</a></h3><p>Updating pages works the same way as pieces with the same arguments to the <code>update</code> method. There are a few things to keep in mind when working on pages, however.</p><p><strong>We typically call the page <code>update</code> method from the main page module: <code>self.apos.page.update()</code>.</strong> Since pages can change their <code>type</code> property (unlike pieces) they share a single <code>update</code> method from the <code>@apostrophecms/page</code> module. <code>self.update()</code> on individual page type modules is simply a wrapper around that method.</p><p><strong><code>update()</code> is not the way to move pages within the <a href="/guide/pages.html#connecting-pages-with-page-tree-navigation">page tree</a>.</strong> The <code>@apostrophecms/page</code> module has <a href="/reference/modules/page.html#async-move-req-pageid-targetid-position">a dedicated <code>move()</code> method</a> for that purpose. The <a href="/reference/api/pages.html#post-api-v1-apostrophecms-page">REST API information about page tree placement</a> has additional information.</p><h2 id="inserting-a-new-piece" tabindex="-1">Inserting a new piece <a class="header-anchor" href="#inserting-a-new-piece" aria-label="Permalink to &quot;Inserting a new piece&quot;">​</a></h2><p>Inserting a new piece works very similarly to updating an existing one. The <code>self.insert</code> method takes the same arguments: <code>self.insert(req, piece, options)</code>. The big difference, of course, is that there is no existing document to find, update, and resubmit.</p><p>Instead, use the <code>self.newInstance()</code> method to get a fresh document object of the proper document type. That method uses the doc type&#39;s <a href="/guide/content-schema.html">field schema</a> to generate the essential document properties with any default values. We can then add any initial data to that essentially blank document object.</p>`,16),D=e("div",{class:"language-javascript"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"javascript"),e("pre",{class:"shiki material-theme-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"module.exports"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#F07178"}},"extend"),e("span",{style:{color:"#89DDFF"}},":"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"@apostrophecms/piece-type"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#89DDFF"}},",")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"  "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// ...")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#F07178"}},"methods"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"("),e("span",{style:{color:"#A6ACCD","font-style":"italic"}},"self"),e("span",{style:{color:"#89DDFF"}},")"),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"    "),e("span",{style:{color:"#A6ACCD"}},"async"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#82AAFF"}},"addNewDog"),e("span",{style:{color:"#F07178"}},"("),e("span",{style:{color:"#A6ACCD"}},"req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"initialInfo"),e("span",{style:{color:"#F07178"}},") "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"      "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// Generate a blank dog data object.")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#C792EA"}},"let"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"newDog"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"newInstance"),e("span",{style:{color:"#F07178"}},"()"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"      "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// Add our initial information to the object.")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#A6ACCD"}},"newDog"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF"}},"..."),e("span",{style:{color:"#A6ACCD"}},"newDog"),e("span",{style:{color:"#89DDFF"}},",")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"        "),e("span",{style:{color:"#89DDFF"}},"..."),e("span",{style:{color:"#A6ACCD"}},"initialInfo")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#89DDFF"}},"};")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"      "),e("span",{style:{color:"#676E95","font-style":"italic"}},"// Insert the dog with the asynchronous `self.insert` method")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#C792EA"}},"const"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"insertResult"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"insert"),e("span",{style:{color:"#F07178"}},"("),e("span",{style:{color:"#A6ACCD"}},"req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"newDog"),e("span",{style:{color:"#F07178"}},")"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"      "),e("span",{style:{color:"#89DDFF","font-style":"italic"}},"return"),e("span",{style:{color:"#F07178"}}," "),e("span",{style:{color:"#A6ACCD"}},"insertResult"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"    "),e("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#F07178"}},"  "),e("span",{style:{color:"#89DDFF"}},"}")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"};")])])])],-1),h=l('<h2 id="inserting-pages" tabindex="-1">Inserting pages <a class="header-anchor" href="#inserting-pages" aria-label="Permalink to &quot;Inserting pages&quot;">​</a></h2><p>As mentioned above, pages have a position within the page tree. The <code>insert</code> method for pages therefore requires additional arguments to place a new page in that hierarchy properly. Also <a href="#updating-page-documents">as described above</a> we normally call the insert method directly from the <code>@apostrophecms/page</code> module, aliased in server-side code as <code>self.apos.page</code>.</p><p>The arguments for the <code>self.apos.page.insert()</code> method are:</p><table><thead><tr><th>Argument</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>req</code></td><td>TRUE</td><td>The associated request object. Using a provided <code>req</code> object is important for maintaining user role permissions.</td></tr><tr><td><code>_targetId</code></td><td>TRUE</td><td>The <code>_id</code> of an existing page to use as a target when inserting the new page. <code>_home</code> and <code>_archive</code> are optional conveniences for the home page and <a href="/reference/api/pages.html#moving-pages-to-the-archive">archived section</a>, respectively.</td></tr><tr><td><code>_position</code></td><td>TRUE</td><td>A numeric value will represent the zero-based child index under the <code>_targetId</code> page. <code>before</code>, <code>after</code>, <code>firstChild</code>, or <code>lastChild</code> values set the position within the page tree for the new page in relation to the target page (see <code>_targetId</code>). <code>before</code> and <code>after</code> insert the new page as a sibling of the target. <code>firstChild</code> and <code>lastChild</code> insert the new page as a child of the target.</td></tr><tr><td><code>page</code></td><td>TRUE</td><td>The page document object.</td></tr><tr><td><code>options</code></td><td>FALSE</td><td>An options object, primarily used for internal draft state management.</td></tr></tbody></table><p>As with pieces, this process will normally begin by generating an empty page document with the <code>newInstance()</code> method, which should be done using a specific page type module.</p>',5),u=e("div",{class:"language-javascript"},[e("button",{title:"Copy Code",class:"copy"}),e("span",{class:"lang"},"javascript"),e("pre",{class:"shiki material-theme-palenight"},[e("code",null,[e("span",{class:"line"},[e("span",{style:{color:"#C792EA"}},"let"),e("span",{style:{color:"#A6ACCD"}}," newPage "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#A6ACCD"}}," self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"newInstance"),e("span",{style:{color:"#A6ACCD"}},"()"),e("span",{style:{color:"#89DDFF"}},";")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"newPage "),e("span",{style:{color:"#89DDFF"}},"="),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"{")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#89DDFF"}},"..."),e("span",{style:{color:"#A6ACCD"}},"newPage"),e("span",{style:{color:"#89DDFF"}},",")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#A6ACCD"}},"  "),e("span",{style:{color:"#89DDFF"}},"..."),e("span",{style:{color:"#A6ACCD"}},"initialInfo")]),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF"}},"};")]),s(`
`),e("span",{class:"line"}),s(`
`),e("span",{class:"line"},[e("span",{style:{color:"#89DDFF","font-style":"italic"}},"await"),e("span",{style:{color:"#A6ACCD"}}," self"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#A6ACCD"}},"apos"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#A6ACCD"}},"page"),e("span",{style:{color:"#89DDFF"}},"."),e("span",{style:{color:"#82AAFF"}},"insert"),e("span",{style:{color:"#A6ACCD"}},"(req"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"_home"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#A6ACCD"}}," "),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#C3E88D"}},"lastChild"),e("span",{style:{color:"#89DDFF"}},"'"),e("span",{style:{color:"#89DDFF"}},","),e("span",{style:{color:"#A6ACCD"}}," newPage)"),e("span",{style:{color:"#89DDFF"}},";")])])])],-1),g=e("div",{class:"info custom-block"},[e("p",{class:"custom-block-title"},"INFO"),e("p",null,[s("With very few exceptions, the "),e("code",null,"_id"),s(" property is an automatically generated, randomized, and (always) unique property. It is also special in that it can never change for a given document.")])],-1);function A(m,C,f,b,w,v){const t=p("AposCodeBlock");return c(),r("div",null,[d,a(t,null,{caption:o(()=>[s(" modules/dog/index.js ")]),default:o(()=>[y,s()]),_:1}),F,a(t,null,{caption:o(()=>[s(" modules/dog/index.js ")]),default:o(()=>[D,s()]),_:1}),h,a(t,null,{caption:o(()=>[s(" modules/special-page/index.js ")]),default:o(()=>[u,s()]),_:1}),g])}const T=n(i,[["render",A]]);export{q as __pageData,T as default};
